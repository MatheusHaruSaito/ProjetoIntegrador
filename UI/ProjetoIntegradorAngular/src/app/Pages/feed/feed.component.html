<div class="feed-page container">

  <!-- ====== Cabeçalho ====== -->
  <div class="feed-header">
    <h2 class="feed-heading">Feed de Publicações</h2>
    <p class="feed-subtitle">Acompanhe as postagens mais recentes da comunidade</p>
  </div>

  <!-- ====== Lista de posts ====== -->
  <div class="feed-list">
    @for (post of posts; track $index) {
      <div class="post-card" (click)="openModal(post.id)">
        <!-- Cabeçalho -->
        <div class="post-header">
          <div class="post-user">
            <img [src]="post.profileImgPath || 'assets/user-placeholder.png'" alt="Imagem do usuário" class="user-avatar">
            <div class="user-info">
              <h3>{{ post.userName || ('Usuário ' + post.userId) }}</h3>
              <p class="post-date">{{ post.createdAt | date:'short' }}</p>
            </div>
          </div>
        </div>

        <!-- Conteúdo -->
        <div class="post-content">
          <h4 class="post-title">{{ post.title }}</h4>
          <p class="post-description">{{ post.description }}</p>
          <img *ngIf="post.postImgPath" [src]="post.postImgPath" alt="Imagem do post" class="post-image">
        </div>

        <!-- Rodapé (votos) -->
        <div class="post-footer">
          <div class="vote-section">
            <button (click)="Vote(post.id); $event.stopPropagation()" class="vote-btn upvote">
              <i class="fas fa-arrow-up"></i>
            </button>
            <span class="vote-count">{{ post.votes }}</span>
          </div>
        </div>
      </div>
    }
  </div>
</div>

<!-- ====== Modal ====== -->
<div class="modal-overlay" *ngIf="selectedPost" (click)="onOverlayClick($event)">
  <div class="modal-window" role="dialog" aria-modal="true">
    <button class="modal-close" (click)="closeModal()" aria-label="Fechar modal">&times;</button>

    <div class="modal-body">
      <!-- Lado esquerdo (imagem) -->
      <div class="modal-left">
        <img *ngIf="selectedPost.postImgPath; else noImage" [src]="selectedPost.postImgPath" alt="Imagem do post" class="modal-image">
        <ng-template #noImage>
          <div class="modal-noimage">Sem imagem</div>
        </ng-template>
      </div>

      <!-- Lado direito (detalhes) -->
      <div class="modal-right">
        <div class="modal-author">
          <img [src]="selectedPost.profileImgPath || 'assets/user-placeholder.png'" alt="Avatar" class="modal-avatar">
          <div>
            <div class="modal-author-name">{{ selectedPost.userName || ('Usuário ' + selectedPost.userId) }}</div>
            <div class="modal-dates">
              <span>Criado: {{ selectedPost.createdAt | date:'short' }}</span>
            </div>
          </div>
        </div>

        <h3 class="modal-title">{{ selectedPost.title }}</h3>
        <p class="modal-description">{{ selectedPost.description }}</p>

        <!-- Votos iguais aos do feed -->
        <div class="modal-footer">
          <div class="vote-section">
            <button (click)="Vote(selectedPost.id); $event.stopPropagation()" class="vote-btn upvote">
              <i class="fas fa-arrow-up"></i>
            </button>
            <span class="vote-count">{{ selectedPost.votes }}</span>
            @for(com of selectedPost.comments; track $index){
              {{com.text}}
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
