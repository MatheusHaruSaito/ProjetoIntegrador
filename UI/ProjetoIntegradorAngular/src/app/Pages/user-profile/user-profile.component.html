<div class="profile-container">
  <main class="profile">

    <!-- ==== CARD DO USUÁRIO ==== -->
    <section class="profile-card">
      <div class="photo">
        <img [src]="user?.profileImgPath || 'images/user-placeholder.png'" alt="Foto de Perfil">
      </div>

      <div class="info">
        <h2>{{ user?.name }}</h2>
        <p class="bio">{{ user?.description || 'Este usuário ainda não escreveu uma biografia.' }}</p>
      </div>
    </section>

    <!-- ==== POSTS DO USUÁRIO ==== -->
    <section class="user-posts" *ngIf="userPosts?.length">
      <h3>Publicações</h3>

      <div class="posts-grid">
        <div class="user-post-card" *ngFor="let post of userPosts" (click)="openPostModal(post.id)">

          <h4 class="user-post-title">{{ post.title }}</h4>

          <div class="user-post-thumb-wrapper" *ngIf="post.postImgPath">
            <img [src]="post.postImgPath" class="user-post-thumb-blur" alt="blur">
            <img [src]="post.postImgPath" class="user-post-thumb" alt="Miniatura">
          </div>

          <p class="user-post-excerpt">{{ post.description }}</p>

        </div>
      </div>
    </section>

    <section class="user-posts" *ngIf="!userPosts?.length">
      <h3>Publicações</h3>
      <p>Este usuário ainda não possui publicações.</p>
    </section>

  </main>
</div>

<!-- ==== MODAL DO POST ==== -->
<div class="modal-overlay" *ngIf="selectedPost" (click)="onOverlayClick($event)">
  <div class="modal-window" (click)="$event.stopPropagation()">

    <button class="modal-close" (click)="closeModal()">×</button>

    <div class="modal-body-vertical">

      <div class="modal-author">
        <img [src]="selectedPost.profileImgPath || 'images/user-placeholder.png'" class="modal-avatar" alt="Avatar"
             (click)="navigateToUserProfile(selectedPost.userId, $event)" style="cursor:pointer">
        <div (click)="navigateToUserProfile(selectedPost.userId, $event)" style="cursor:pointer">
          <div class="modal-author-name">{{ selectedPost.userName }}</div>
          <div class="modal-dates">Criado: {{ selectedPost.createdAt | date:'short' }}</div>
        </div>
      </div>

      <h3 class="modal-title">{{ selectedPost.title }}</h3>

      <div class="modal-image-wrapper" *ngIf="selectedPost.postImgPath">
        <img [src]="selectedPost.postImgPath" class="modal-image-blur" alt="bg">
        <img [src]="selectedPost.postImgPath" class="modal-image-vertical" alt="Imagem">
      </div>

      <p class="modal-description-long">{{ selectedPost.description }}</p>

      <div class="modal-vote-box">
        <button class="vote-btn" (click)="Vote(selectedPost.id); $event.stopPropagation()">
          <i class="fas fa-arrow-up"></i>
        </button>
        <span class="vote-count">{{ selectedPost.votes }}</span>
      </div>

      <div class="comments-section">
        <h3 class="comments-header">Comentários ({{ currentComments.length }})</h3>

        <div class="comments-list">
          <div class="comment-item" *ngFor="let c of currentComments">

            <img [src]="c.userProfileImgPath || 'images/user-placeholder.png'" class="comment-avatar"
                 (click)="navigateToUserProfile(c.userId, $event)" style="cursor:pointer">

            <div class="comment-body">
              <div class="comment-meta">
                <strong (click)="navigateToUserProfile(c.userId, $event)" style="cursor:pointer">{{ c.userUsername }}</strong>
                <span>{{ c.createdAt | date:'short' }}</span>
              </div>

              <p class="comment-text">{{ c.text }}</p>
            </div>

            <div class="comment-vote">
              <button class="vote-btn" (click)="voteComment(c.id); $event.stopPropagation()">
                <i class="fas fa-arrow-up"></i>
              </button>
              <span class="comment-votes">{{ c.vote }}</span>
            </div>

          </div>
        </div>

        <div *ngIf="loggedUser">
          <textarea [(ngModel)]="newCommentText" class="comment-input" rows="3" placeholder="Escreva algo..."></textarea>
          <button class="btn-publish" (click)="sendComment()">Comentar</button>
        </div>
        
        <div *ngIf="!loggedUser" class="login-prompt">
          <p>Faça login para comentar</p>
        </div>

      </div>

    </div>
  </div>
</div>